<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»Šå¤©åƒä»€éº¼ â—¡Ìˆ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Shippori+Mincho:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBNbACvPAqK-yXrlAfsdum1PZPUJyuEVII&libraries=places,geometry&language=zh-TW&callback=initMap" async defer></script>
    <style>
        :root {
            --cream: #FFF8F0;
            --cream-dark: #F5E6D3;
            --butter: #FFE4C4;
            --caramel: #D4A574;
            --mocha: #8B6F47;
            --text-dark: #4A3F35;
            --text-light: #6B5D52;
            --accent-pink: #F5CBA7;
            --accent-peach: #FFDAB9;
            --shadow: rgba(139, 111, 71, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', 'Shippori Mincho', serif;
            background: linear-gradient(135deg, var(--cream) 0%, var(--butter) 100%);
            color: var(--text-dark);
            min-height: 100vh;
            padding: 2rem 1rem;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 228, 196, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(245, 203, 167, 0.2) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            animation: slideDown 0.6s ease-out;
            position: relative;
        }

        .favorites-btn {
            position: absolute;
            top: 0;
            right: 0;
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--accent-pink);
            border-radius: 16px;
            color: var(--mocha);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .favorites-btn:hover {
            background: var(--accent-pink);
            transform: translateY(-2px);
        }

        .favorites-count {
            background: var(--mocha);
            color: white;
            padding: 0.125rem 0.5rem;
            border-radius: 12px;
            font-size: 0.85rem;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-family: 'Shippori Mincho', serif;
            font-size: 2.8rem;
            font-weight: 600;
            color: var(--mocha);
            margin-bottom: 0.5rem;
            letter-spacing: 0.05em;
        }

        .subtitle {
            font-size: 1rem;
            color: var(--text-light);
            font-weight: 300;
        }

        .search-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 2.5rem;
            box-shadow: 0 10px 40px var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 228, 196, 0.5);
            animation: scaleIn 0.5s ease-out 0.2s both;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--mocha);
            font-size: 0.95rem;
        }

        select, input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid var(--cream-dark);
            border-radius: 16px;
            font-size: 1rem;
            font-family: 'Noto Sans TC', sans-serif;
            background: white;
            color: var(--text-dark);
            transition: all 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--caramel);
            box-shadow: 0 0 0 4px rgba(212, 165, 116, 0.1);
        }

        .input-row {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
        }

        .input-row input {
            flex: 1;
        }

        button {
            padding: 1rem 2rem;
            border: none;
            border-radius: 16px;
            font-size: 1rem;
            font-family: 'Noto Sans TC', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--caramel) 0%, var(--mocha) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(139, 111, 71, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 111, 71, 0.3);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--accent-pink);
            color: var(--mocha);
        }

        .btn-secondary:hover {
            background: var(--accent-peach);
            transform: translateY(-2px);
        }

        .search-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .search-buttons button {
            flex: 1;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--cream-dark);
            border-top-color: var(--caramel);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .results {
            display: grid;
            gap: 1.25rem;
        }

        .restaurant-card {
            background: white;
            border-radius: 20px;
            padding: 1.75rem;
            box-shadow: 0 4px 20px var(--shadow);
            border: 1px solid var(--cream-dark);
            transition: all 0.3s ease;
            animation: slideUp 0.4s ease-out both;
        }

        .restaurant-card:nth-child(1) { animation-delay: 0.05s; }
        .restaurant-card:nth-child(2) { animation-delay: 0.1s; }
        .restaurant-card:nth-child(3) { animation-delay: 0.15s; }
        .restaurant-card:nth-child(4) { animation-delay: 0.2s; }
        .restaurant-card:nth-child(5) { animation-delay: 0.25s; }
        .restaurant-card:nth-child(6) { animation-delay: 0.3s; }
        .restaurant-card:nth-child(7) { animation-delay: 0.35s; }
        .restaurant-card:nth-child(8) { animation-delay: 0.4s; }
        .restaurant-card:nth-child(9) { animation-delay: 0.45s; }
        .restaurant-card:nth-child(10) { animation-delay: 0.5s; }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .restaurant-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px var(--shadow);
        }

        .restaurant-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .restaurant-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--mocha);
            margin-bottom: 0.25rem;
        }

        .header-right {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .favorite-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            transition: all 0.3s ease;
            line-height: 1;
        }

        .favorite-btn:hover {
            transform: scale(1.2);
        }

        .favorite-btn.active {
            color: #FF69B4;
        }

        .business-hours {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--cream-dark);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .restaurant-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: #D4EDDA;
            color: #155724;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .restaurant-info {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .rating {
            color: #F4A460;
            font-weight: 600;
        }

        .distance {
            color: var(--caramel);
            font-weight: 500;
        }

        .price-level {
            color: var(--mocha);
            font-weight: 600;
        }

        .price-range {
            color: var(--text-light);
            font-size: 0.85rem;
            font-weight: 400;
            margin-left: 0.25rem;
        }

        .share-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid var(--caramel);
            border-radius: 12px;
            color: var(--mocha);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 1rem;
        }

        .share-btn:hover {
            background: var(--caramel);
            color: white;
            transform: translateY(-2px);
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--mocha);
            color: white;
            padding: 1rem 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 2000;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .map-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.25rem;
            background: var(--cream-dark);
            color: var(--mocha);
            text-decoration: none;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .map-link:hover {
            background: var(--caramel);
            color: white;
            transform: translateX(4px);
        }

        .no-results {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .no-results-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        /* æ”¶è—æ¸…å–®å½ˆå‡ºè¦–çª— */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--cream);
            border-radius: 24px;
            padding: 2rem;
            max-width: 800px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--mocha);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            padding: 0.5rem;
            transition: all 0.3s ease;
            line-height: 1;
        }

        .close-btn:hover {
            color: var(--mocha);
            transform: rotate(90deg);
        }

        .favorites-list {
            display: grid;
            gap: 1rem;
        }

        .empty-favorites {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-light);
        }

        .empty-favorites-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 640px) {
            h1 {
                font-size: 2rem;
            }

            .search-card {
                padding: 1.5rem;
            }

            .search-buttons {
                flex-direction: column;
            }

            .input-row {
                flex-direction: column;
                align-items: stretch;
            }

            .restaurant-info {
                flex-direction: column;
                gap: 0.5rem;
            }

            .favorites-btn {
                position: static;
                margin: 1rem auto 0;
                display: inline-flex;
            }

            header {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .modal-content {
                padding: 1.5rem;
                margin: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ä»Šå¤©åƒä»€éº¼ ğŸ±âœ¨</h1>
            <p class="subtitle">åœ¨å°åŒ—å°‹æ‰¾ç¾å‘³çš„ä¸‹ä¸€é¤</p>
            <button class="favorites-btn" id="favoritesBtn">
                â™¥ æˆ‘çš„æ”¶è— <span class="favorites-count" id="favoritesCount">0</span>
            </button>
        </header>

        <div class="search-card">
            <div class="form-group">
                <label for="line">é¸æ“‡æ·é‹è·¯ç·š</label>
                <select id="line">
                    <option value="">è«‹é¸æ“‡è·¯ç·š</option>
                    <option value="red">ğŸ”´ æ·¡æ°´ä¿¡ç¾©ç·šï¼ˆç´…ç·šï¼‰</option>
                    <option value="blue">ğŸ”µ æ¿å—ç·šï¼ˆè—ç·šï¼‰</option>
                    <option value="green">ğŸŸ¢ æ¾å±±æ–°åº—ç·šï¼ˆç¶ ç·šï¼‰</option>
                    <option value="orange">ğŸŸ  ä¸­å’Œæ–°è˜†ç·šï¼ˆæ©˜ç·šï¼‰</option>
                    <option value="brown">ğŸŸ¤ æ–‡æ¹–ç·šï¼ˆæ£•ç·šï¼‰</option>
                </select>
            </div>

            <div class="form-group">
                <label for="station">é¸æ“‡æ·é‹ç«™</label>
                <select id="station" disabled>
                    <option value="">è«‹å…ˆé¸æ“‡è·¯ç·š</option>
                </select>
            </div>

            <div class="form-group">
                <label for="foodType">æƒ³åƒä»€éº¼ï¼Ÿ</label>
                <div class="input-row">
                    <input type="text" id="foodType" placeholder="ä¾‹å¦‚ï¼šæ‹‰éºµã€ç«é‹ã€å’–å•¡å»³...">
                    <button class="btn-secondary" id="randomBtn">ä»Šå¤©æ²’æœ‰ä»€éº¼æƒ³æ³•~</button>
                </div>
            </div>

            <div class="search-buttons">
                <button class="btn-primary" id="searchBtn">é–‹å§‹å°‹æ‰¾ç¾é£Ÿ âœ¨</button>
            </div>
        </div>

        <div id="loadingArea" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>æ­£åœ¨å°‹æ‰¾é™„è¿‘çš„ç¾é£Ÿ...</p>
        </div>

        <div id="resultsArea" class="results"></div>
    </div>

    <!-- æ”¶è—æ¸…å–®å½ˆå‡ºè¦–çª— -->
    <div class="modal-overlay" id="favoritesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">â™¥ æˆ‘çš„æ”¶è—</h2>
                <button class="close-btn" id="closeModal">âœ•</button>
            </div>
            <div class="favorites-list" id="favoritesList"></div>
        </div>
    </div>

    <!-- Toast æç¤º -->
    <div class="toast" id="toast"></div>

    <script>
        const API_KEY = 'AIzaSyBNbACvPAqK-yXrlAfsdum1PZPUJyuEVII';
        let isGoogleMapsLoaded = false;

        // Google Maps API è¼‰å…¥å®Œæˆçš„å›èª¿å‡½æ•¸
        function initMap() {
            isGoogleMapsLoaded = true;
            console.log('Google Maps API è¼‰å…¥å®Œæˆ');
        }
        
        // å°åŒ—æ·é‹ç«™åˆ—è¡¨ï¼ˆæŒ‰è·¯ç·šåˆ†é¡ï¼‰
        const mrtLines = {
            red: {
                name: 'æ·¡æ°´ä¿¡ç¾©ç·š',
                stations: ['æ·¡æ°´ç«™', 'ç´…æ¨¹æ—ç«™', 'ç«¹åœç«™', 'é—œæ¸¡ç«™', 'å¿ ç¾©ç«™', 'å¾©èˆˆå´—ç«™', 'åŒ—æŠ•ç«™', 'æ–°åŒ—æŠ•ç«™', 'å¥‡å²©ç«™', 'å”­å“©å²¸ç«™', 'çŸ³ç‰Œç«™', 'æ˜å¾·ç«™', 'èŠå±±ç«™', 'å£«æ—ç«™', 'åŠæ½­ç«™', 'åœ“å±±ç«™', 'æ°‘æ¬Šè¥¿è·¯ç«™', 'é›™é€£ç«™', 'ä¸­å±±ç«™', 'å°åŒ—è»Šç«™', 'å°å¤§é†«é™¢ç«™', 'ä¸­æ­£ç´€å¿µå ‚ç«™', 'æ±é–€ç«™', 'å¤§å®‰æ£®æ—å…¬åœ’ç«™', 'å¤§å®‰ç«™', 'ä¿¡ç¾©å®‰å’Œç«™', 'å°åŒ—101/ä¸–è²¿ç«™', 'è±¡å±±ç«™']
            },
            blue: {
                name: 'æ¿å—ç·š',
                stations: ['é ‚åŸ”ç«™', 'æ°¸å¯§ç«™', 'åœŸåŸç«™', 'æµ·å±±ç«™', 'äºæ±é†«é™¢ç«™', 'åºœä¸­ç«™', 'æ¿æ©‹ç«™', 'æ–°åŸ”ç«™', 'æ±Ÿå­ç¿ ç«™', 'é¾å±±å¯ºç«™', 'è¥¿é–€ç«™', 'å°åŒ—è»Šç«™', 'å–„å°å¯ºç«™', 'å¿ å­æ–°ç”Ÿç«™', 'å¿ å­å¾©èˆˆç«™', 'å¿ å­æ•¦åŒ–ç«™', 'åœ‹çˆ¶ç´€å¿µé¤¨ç«™', 'å¸‚æ”¿åºœç«™', 'æ°¸æ˜¥ç«™', 'å¾Œå±±åŸ¤ç«™', 'æ˜†é™½ç«™', 'å—æ¸¯ç«™', 'å—æ¸¯å±•è¦½é¤¨ç«™']
            },
            green: {
                name: 'æ¾å±±æ–°åº—ç·š',
                stations: ['æ¾å±±ç«™', 'å—äº¬ä¸‰æ°‘ç«™', 'å°åŒ—å°å·¨è›‹ç«™', 'å—äº¬å¾©èˆˆç«™', 'æ¾æ±Ÿå—äº¬ç«™', 'ä¸­å±±ç«™', 'åŒ—é–€ç«™', 'ä¸­æ­£ç´€å¿µå ‚ç«™', 'å°å—é–€ç«™', 'å¤äº­ç«™', 'å°é›»å¤§æ¨“ç«™', 'å…¬é¤¨ç«™', 'è¬éš†ç«™', 'æ™¯ç¾ç«™', 'å¤§åªæ—ç«™', 'ä¸ƒå¼µç«™', 'æ–°åº—å€å…¬æ‰€ç«™', 'æ–°åº—ç«™']
            },
            orange: {
                name: 'ä¸­å’Œæ–°è˜†ç·š',
                stations: ['è¿´é¾ç«™', 'ä¸¹é³³ç«™', 'è¼”å¤§ç«™', 'æ–°èŠç«™', 'é ­å‰åº„ç«™', 'å…ˆå—‡å®®ç«™', 'ä¸‰é‡ç«™', 'èœå¯®ç«™', 'å°åŒ—æ©‹ç«™', 'å¤§æ©‹é ­ç«™', 'ä¸­å±±åœ‹å°ç«™', 'è¡Œå¤©å®®ç«™', 'æ¾æ±Ÿå—äº¬ç«™', 'å¿ å­æ–°ç”Ÿç«™', 'æ±é–€ç«™', 'å¤äº­ç«™', 'é ‚æºªç«™', 'æ°¸å®‰å¸‚å ´ç«™', 'æ™¯å®‰ç«™', 'å—å‹¢è§’ç«™', 'è˜†æ´²ç«™', 'ä¸‰æ°‘é«˜ä¸­ç«™', 'å¾åŒ¯ä¸­å­¸ç«™', 'ä¸‰å’Œåœ‹ä¸­ç«™', 'ä¸‰é‡åœ‹å°ç«™']
            },
            brown: {
                name: 'æ–‡æ¹–ç·š',
                stations: ['å‹•ç‰©åœ’ç«™', 'æœ¨æŸµç«™', 'è¬èŠ³ç¤¾å€ç«™', 'è¬èŠ³é†«é™¢ç«™', 'è¾›äº¥ç«™', 'éºŸå…‰ç«™', 'å…­å¼µçŠç«™', 'ç§‘æŠ€å¤§æ¨“ç«™', 'å¤§å®‰ç«™', 'å¿ å­å¾©èˆˆç«™', 'å—äº¬å¾©èˆˆç«™', 'ä¸­å±±åœ‹ä¸­ç«™', 'æ¾å±±æ©Ÿå ´ç«™', 'å¤§ç›´ç«™', 'åŠå—è·¯ç«™', 'å…§æ¹–ç«™', 'æ–‡å¾·ç«™', 'æ¸¯å¢˜ç«™', 'è¥¿æ¹–ç«™', 'å¤§æ¹–å…¬åœ’ç«™', 'è‘«æ´²ç«™', 'æ±æ¹–ç«™', 'å—æ¸¯è»Ÿé«”åœ’å€ç«™', 'å—æ¸¯å±•è¦½é¤¨ç«™']
            }
        };

        // é£Ÿç‰©é¡å‹èˆ‡ emoji å°æ‡‰
        const foodEmojis = {
            'æ‹‰éºµ': 'ğŸœ',
            'ç«é‹': 'ğŸ²',
            'å’–å•¡å»³': 'â˜•',
            'æ—¥å¼æ–™ç†': 'ğŸ±',
            'ç¾©å¼æ–™ç†': 'ğŸ',
            'å°å¼æ–™ç†': 'ğŸš',
            'éŸ“å¼æ–™ç†': 'ğŸ›',
            'æ—©åˆé¤': 'ğŸ¥',
            'ç”œé»': 'ğŸ°',
            'ç‡’çƒ¤': 'ğŸ–',
            'å°åƒ': 'ğŸ¥Ÿ',
            'æ³°å¼æ–™ç†': 'ğŸŒ¶ï¸',
            'æ¸¯å¼é£²èŒ¶': 'ğŸ¥®',
            'ç‰›æ’': 'ğŸ¥©',
            'ç´ é£Ÿ': 'ğŸ¥—',
            'æŠ«è–©': 'ğŸ•',
            'æ¼¢å ¡': 'ğŸ”',
            'å£½å¸': 'ğŸ£',
            'ä¸²ç‡’': 'ï¿½ä¸²',
            'æµ·é®®': 'ğŸ¦'
        };

        // åˆå§‹åŒ–è·¯ç·šå’Œç«™é»é¸å–®
        const lineSelect = document.getElementById('line');
        const stationSelect = document.getElementById('station');
        const foodTypeInput = document.getElementById('foodType');

        // ç•¶è·¯ç·šæ”¹è®Šæ™‚ï¼Œæ›´æ–°ç«™é»é¸å–®
        lineSelect.addEventListener('change', () => {
            const selectedLine = lineSelect.value;
            stationSelect.innerHTML = '<option value="">è«‹é¸æ“‡æ·é‹ç«™</option>';
            
            if (selectedLine && mrtLines[selectedLine]) {
                stationSelect.disabled = false;
                mrtLines[selectedLine].stations.forEach(station => {
                    const option = document.createElement('option');
                    option.value = station;
                    option.textContent = station;
                    stationSelect.appendChild(option);
                });
            } else {
                stationSelect.disabled = true;
            }
        });

        // éš¨æ©Ÿé¸æ“‡é£Ÿç‰©é¡å‹
        document.getElementById('randomBtn').addEventListener('click', () => {
            const foodTypesList = Object.keys(foodEmojis);
            const randomType = foodTypesList[Math.floor(Math.random() * foodTypesList.length)];
            foodTypeInput.value = randomType;
        });

        // æœå°‹åŠŸèƒ½
        document.getElementById('searchBtn').addEventListener('click', async () => {
            const station = document.getElementById('station').value;
            const foodType = document.getElementById('foodType').value;

            if (!station) {
                alert('è«‹é¸æ“‡ä¸€å€‹æ·é‹ç«™ï¼');
                return;
            }

            if (!foodType) {
                alert('è«‹è¼¸å…¥æƒ³åƒçš„é¡å‹ï¼Œæˆ–æŒ‰ã€Œä»Šå¤©æ²’æœ‰ä»€éº¼æƒ³æ³•~ã€è®“æˆ‘å€‘å¹«ä½ æ±ºå®šï¼');
                return;
            }

            // æª¢æŸ¥ Google Maps API æ˜¯å¦å·²è¼‰å…¥
            if (!isGoogleMapsLoaded || typeof google === 'undefined') {
                alert('åœ°åœ–æœå‹™è¼‰å…¥ä¸­ï¼Œè«‹ç¨å¾Œå†è©¦...');
                return;
            }

            showLoading();
            await searchRestaurants(station, foodType);
        });

        function showLoading() {
            document.getElementById('loadingArea').style.display = 'block';
            document.getElementById('resultsArea').innerHTML = '';
        }

        function hideLoading() {
            document.getElementById('loadingArea').style.display = 'none';
        }

        async function searchRestaurants(station, foodType) {
            try {
                // 1. å–å¾—æ·é‹ç«™åº§æ¨™
                const geocoder = new google.maps.Geocoder();
                const geocodeResult = await new Promise((resolve, reject) => {
                    geocoder.geocode({ 
                        address: `${station}, å°åŒ—å¸‚`,
                        region: 'TW'
                    }, (results, status) => {
                        if (status === 'OK') {
                            resolve(results[0].geometry.location);
                        } else {
                            reject(status);
                        }
                    });
                });

                // 2. æœå°‹é™„è¿‘é¤å»³
                const service = new google.maps.places.PlacesService(document.createElement('div'));
                const request = {
                    location: geocodeResult,
                    radius: 500,
                    keyword: foodType,
                    type: 'restaurant',
                    openNow: true, // åªé¡¯ç¤ºç‡Ÿæ¥­ä¸­çš„åº—
                    language: 'zh-TW'
                };

                const results = await new Promise((resolve, reject) => {
                    service.nearbySearch(request, (results, status) => {
                        if (status === google.maps.places.PlacesServiceStatus.OK) {
                            resolve(results);
                        } else if (status === google.maps.places.PlacesServiceStatus.ZERO_RESULTS) {
                            resolve([]);
                        } else {
                            reject(status);
                        }
                    });
                });

                // 3. éæ¿¾çµæœï¼šåªæ’é™¤æ˜é¡¯è¡çªçš„é¡å‹
                const filteredResults = results.filter(place => {
                    const name = place.name.toLowerCase();
                    
                    // åªæ’é™¤æ˜é¡¯è¡çªçš„åº—å®¶é¡å‹
                    const excludeKeywords = getStrictExcludeKeywords(foodType);
                    const isExcluded = excludeKeywords.some(excluded => {
                        // å¿…é ˆæ˜¯åº—åä¸­æ˜ç¢ºåŒ…å«è¡çªé—œéµå­—æ‰æ’é™¤
                        return name.includes(excluded);
                    });
                    
                    return !isExcluded;
                });

                // æª¢æŸ¥æ˜¯å¦æœ‰ç²¾æº–åŒ¹é…ï¼ˆåº—åä¸­åŒ…å«é—œéµå­—ï¼‰
                const exactMatches = filteredResults.filter(place => {
                    const name = place.name.toLowerCase();
                    const keyword = foodType.toLowerCase();
                    return name.includes(keyword);
                });
                
                const isExactMatch = exactMatches.length > 0;
                
                // ä½¿ç”¨éæ¿¾å¾Œçš„çµæœ
                const finalResults = filteredResults;

                // 4. å–å¾—è©³ç´°è³‡è¨Šä¸¦è¨ˆç®—è·é›¢ï¼ˆä¸é™åˆ¶æ•¸é‡ï¼‰
                const detailedResults = await Promise.all(
                    finalResults.map(async (place) => {
                        // å–å¾—è©³ç´°è³‡è¨Š
                        const details = await new Promise((resolve) => {
                            service.getDetails({ 
                                placeId: place.place_id,
                                fields: ['name', 'rating', 'user_ratings_total', 'price_level', 'opening_hours', 'url', 'geometry', 'place_id']
                            }, (result, status) => {
                                if (status === google.maps.places.PlacesServiceStatus.OK) {
                                    resolve(result);
                                } else {
                                    resolve(null);
                                }
                            });
                        });

                        if (!details) return null;

                        // è¨ˆç®—è·é›¢
                        const distance = google.maps.geometry.spherical.computeDistanceBetween(
                            geocodeResult,
                            details.geometry.location
                        );

                        // å–å¾—ç‡Ÿæ¥­æ™‚é–“
                        let businessHours = '';
                        if (details.opening_hours && details.opening_hours.weekday_text) {
                            const today = new Date().getDay();
                            const dayIndex = today === 0 ? 6 : today - 1; // è½‰æ›ç‚º weekday_text çš„ç´¢å¼•
                            businessHours = details.opening_hours.weekday_text[dayIndex] || '';
                            // ç§»é™¤æ˜ŸæœŸå¹¾çš„æ–‡å­—ï¼Œåªä¿ç•™æ™‚é–“
                            businessHours = businessHours.replace(/^[\u4e00-\u9fa5]+:\s*/, '');
                        }

                        return {
                            id: details.place_id,
                            name: details.name,
                            rating: details.rating || 'N/A',
                            reviewCount: details.user_ratings_total || 0,
                            priceLevel: details.price_level || 0,
                            distance: Math.round(distance),
                            isOpen: details.opening_hours?.isOpen() ?? true,
                            url: details.url,
                            businessHours: businessHours
                        };
                    })
                );

                // éæ¿¾æ‰æ²’æœ‰å–å¾—è³‡è¨Šçš„é …ç›®
                const validResults = detailedResults.filter(r => r !== null);

                displayResults(validResults, isExactMatch);
            } catch (error) {
                console.error('æœå°‹éŒ¯èª¤:', error);
                hideLoading();
                displayNoResults();
            }
        }

        function displayResults(restaurants, isExactMatch = true) {
            hideLoading();
            const resultsArea = document.getElementById('resultsArea');
            const foodType = document.getElementById('foodType').value;
            const foodEmoji = getFoodEmoji(foodType);
            
            if (restaurants.length === 0) {
                displayNoResults();
                return;
            }

            // æ ¹æ“šæ˜¯å¦ç²¾æº–åŒ¹é…é¡¯ç¤ºä¸åŒçš„è¨Šæ¯
            let summaryText = '';
            if (isExactMatch) {
                summaryText = `${foodEmoji} æ‰¾åˆ° ${restaurants.length} å®¶${foodType}é¤å»³`;
            } else {
                summaryText = `æ‰¾ä¸åˆ°å°ˆè³£${foodType}çš„é¤å»³ï¼Œä½†ä»¥ä¸‹æ˜¯é™„è¿‘å¯èƒ½æœ‰è²©å”®çš„åº—å®¶`;
            }

            // åœ¨çµæœå‰åŠ å…¥æœå°‹æ‘˜è¦å’Œåˆ†äº«æŒ‰éˆ•
            const summaryHtml = `
                <div style="text-align: center; margin-bottom: 2rem; padding: 1.5rem; background: rgba(255, 255, 255, 0.6); border-radius: 16px;">
                    <p style="font-size: 1.25rem; color: var(--mocha); font-weight: 500;">
                        ${summaryText}
                        <button class="share-btn" onclick="shareSearch()">ğŸ”— åˆ†äº«æœå°‹</button>
                    </p>
                </div>
            `;

            const cardsHtml = restaurants.map(restaurant => {
                const priceSymbol = '$'.repeat(restaurant.priceLevel || 1);
                const priceRange = getPriceRange(restaurant.priceLevel);
                const statusText = restaurant.isOpen ? 'ç‡Ÿæ¥­ä¸­' : 'å·²æ‰“çƒŠ';
                const statusClass = restaurant.isOpen ? 'restaurant-status' : 'restaurant-status closed';
                const isFavorite = checkIfFavorite(restaurant.id);
                const favoriteClass = isFavorite ? 'active' : '';
                const favoriteIcon = isFavorite ? 'â™¥' : 'â™¡';

                return `
                    <div class="restaurant-card">
                        <div class="restaurant-header">
                            <div>
                                <div class="restaurant-name">${foodEmoji} ${restaurant.name}</div>
                            </div>
                            <div class="header-right">
                                <span class="${statusClass}">${statusText}</span>
                                <button class="favorite-btn ${favoriteClass}" onclick="toggleFavorite('${restaurant.id}', event)" data-id="${restaurant.id}">
                                    ${favoriteIcon}
                                </button>
                            </div>
                        </div>
                        <div class="restaurant-info">
                            <div class="info-item">
                                <span class="rating">â˜… ${restaurant.rating}</span>
                                <span>(${restaurant.reviewCount})</span>
                            </div>
                            <div class="info-item">
                                <span class="price-level">${priceSymbol}</span>
                                ${priceRange ? `<span class="price-range">${priceRange}</span>` : ''}
                            </div>
                            <div class="info-item">
                                <span class="distance">ğŸ“ ${restaurant.distance}m</span>
                            </div>
                        </div>
                        ${restaurant.businessHours ? `<div class="business-hours">ğŸ• ${restaurant.businessHours}</div>` : ''}
                        <a href="${restaurant.url}" target="_blank" class="map-link">
                            åœ¨ Google Maps æŸ¥çœ‹ â†’
                        </a>
                    </div>
                `;
            }).join('');

            resultsArea.innerHTML = summaryHtml + cardsHtml;
            // å°‡é¤å»³è³‡æ–™å­˜åˆ°å…¨åŸŸè®Šæ•¸ä¾›æ”¶è—åŠŸèƒ½ä½¿ç”¨
            window.currentRestaurants = restaurants;
        }

        // å–å¾—é£Ÿç‰©é¡å‹å°æ‡‰çš„ emoji
        function getFoodEmoji(foodType) {
            // å®Œå…¨åŒ¹é…
            if (foodEmojis[foodType]) {
                return foodEmojis[foodType];
            }
            
            // éƒ¨åˆ†åŒ¹é…ï¼ˆä¾‹å¦‚ï¼šæ—¥æœ¬æ–™ç† â†’ æ—¥å¼æ–™ç†ï¼‰
            for (const [key, emoji] of Object.entries(foodEmojis)) {
                if (foodType.includes(key.replace('æ–™ç†', '')) || key.includes(foodType)) {
                    return emoji;
                }
            }
            
            // é è¨­
            return 'ğŸ½ï¸';
        }

        // æ ¹æ“šé£Ÿç‰©é¡å‹å–å¾—éœ€è¦åš´æ ¼æ’é™¤çš„é—œéµå­—ï¼ˆåªæ’é™¤æ˜é¡¯è¡çªçš„ï¼‰
        function getStrictExcludeKeywords(foodType) {
            const excludeMap = {
                'å’–å•¡å»³': ['ç«é‹', 'éº»è¾£é‹', 'æ¶®æ¶®é‹', 'ç‡’è‚‰', 'çƒ¤è‚‰', 'æ‹‰éºµ'],
                'å’–å•¡': ['ç«é‹', 'éº»è¾£é‹', 'æ¶®æ¶®é‹', 'ç‡’è‚‰', 'çƒ¤è‚‰', 'æ‹‰éºµ'],
                'ç”œé»': ['ç«é‹', 'éº»è¾£é‹', 'æ¶®æ¶®é‹', 'ç‡’è‚‰', 'çƒ¤è‚‰', 'æ‹‰éºµ', 'ç‰›æ’'],
                'è›‹ç³•': ['ç«é‹', 'éº»è¾£é‹', 'æ¶®æ¶®é‹', 'ç‡’è‚‰', 'çƒ¤è‚‰', 'æ‹‰éºµ', 'ç‰›æ’'],
                'ç«é‹': ['å’–å•¡å»³', 'å’–å•¡é¤¨', 'è›‹ç³•', 'ç”œé»'],
                'æ‹‰éºµ': ['å’–å•¡å»³', 'å’–å•¡é¤¨', 'è›‹ç³•', 'ç”œé»', 'ç«é‹'],
                'ç‡’çƒ¤': ['å’–å•¡å»³', 'å’–å•¡é¤¨', 'è›‹ç³•', 'ç”œé»'],
                'ç‡’è‚‰': ['å’–å•¡å»³', 'å’–å•¡é¤¨', 'è›‹ç³•', 'ç”œé»'],
                'ç‰›æ’': ['å’–å•¡å»³', 'å’–å•¡é¤¨', 'è›‹ç³•', 'ç”œé»', 'æ‹‰éºµ', 'ç«é‹']
            };
            
            const foodTypeLower = foodType.toLowerCase();
            for (const [key, excludes] of Object.entries(excludeMap)) {
                if (foodTypeLower.includes(key.toLowerCase()) || key.toLowerCase().includes(foodTypeLower)) {
                    return excludes.map(e => e.toLowerCase());
                }
            }
            
            return [];
        }

        // æ ¹æ“š price_level å–å¾—åƒ¹æ ¼ç¯„åœ
        function getPriceRange(priceLevel) {
            const priceRanges = {
                0: '',
                1: 'NT$100ä»¥ä¸‹',
                2: 'NT$100-300',
                3: 'NT$300-600',
                4: 'NT$600ä»¥ä¸Š'
            };
            return priceRanges[priceLevel] || '';
        }

        function displayNoResults() {
            const resultsArea = document.getElementById('resultsArea');
            resultsArea.innerHTML = `
                <div class="no-results">
                    <div class="no-results-icon">ğŸ½ï¸</div>
                    <p>é™„è¿‘æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„é¤å»³</p>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem; color: var(--text-light);">è©¦è©¦çœ‹å…¶ä»–æ·é‹ç«™æˆ–é£Ÿç‰©é¡å‹å§ï¼</p>
                </div>
            `;
        }

        // ========== æ”¶è—åŠŸèƒ½ ==========
        
        // åˆå§‹åŒ–æ”¶è—æ•¸é‡é¡¯ç¤º
        function updateFavoritesCount() {
            const favorites = getFavorites();
            document.getElementById('favoritesCount').textContent = favorites.length;
        }

        // å–å¾—æ”¶è—æ¸…å–®
        function getFavorites() {
            const favorites = localStorage.getItem('favoriteRestaurants');
            return favorites ? JSON.parse(favorites) : [];
        }

        // å„²å­˜æ”¶è—æ¸…å–®
        function saveFavorites(favorites) {
            localStorage.setItem('favoriteRestaurants', JSON.stringify(favorites));
            updateFavoritesCount();
        }

        // æª¢æŸ¥æ˜¯å¦å·²æ”¶è—
        function checkIfFavorite(restaurantId) {
            const favorites = getFavorites();
            return favorites.some(fav => fav.id === restaurantId);
        }

        // åˆ‡æ›æ”¶è—ç‹€æ…‹
        function toggleFavorite(restaurantId, event) {
            event.preventDefault();
            event.stopPropagation();
            
            const favorites = getFavorites();
            const index = favorites.findIndex(fav => fav.id === restaurantId);
            
            if (index > -1) {
                // å·²æ”¶è—ï¼Œç§»é™¤
                favorites.splice(index, 1);
            } else {
                // æœªæ”¶è—ï¼Œæ–°å¢
                const restaurant = window.currentRestaurants.find(r => r.id === restaurantId);
                if (restaurant) {
                    favorites.push(restaurant);
                }
            }
            
            saveFavorites(favorites);
            
            // æ›´æ–°æ„›å¿ƒåœ–ç¤º
            const btn = event.target;
            if (index > -1) {
                btn.classList.remove('active');
                btn.textContent = 'â™¡';
            } else {
                btn.classList.add('active');
                btn.textContent = 'â™¥';
            }
        }

        // é¡¯ç¤ºæ”¶è—æ¸…å–®
        function showFavorites() {
            const favorites = getFavorites();
            const favoritesList = document.getElementById('favoritesList');
            const modal = document.getElementById('favoritesModal');
            
            if (favorites.length === 0) {
                favoritesList.innerHTML = `
                    <div class="empty-favorites">
                        <div class="empty-favorites-icon">ğŸ½ï¸</div>
                        <p>é‚„æ²’æœ‰æ”¶è—ä»»ä½•é¤å»³</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem; color: var(--text-light);">æœå°‹é¤å»³å¾Œé»æ“Šæ„›å¿ƒå³å¯æ”¶è—ï¼</p>
                    </div>
                `;
            } else {
                const cardsHtml = favorites.map(restaurant => {
                    const priceSymbol = '$'.repeat(restaurant.priceLevel || 1);
                    const priceRange = getPriceRange(restaurant.priceLevel);
                    const foodEmoji = 'ğŸ½ï¸';
                    
                    return `
                        <div class="restaurant-card">
                            <div class="restaurant-header">
                                <div>
                                    <div class="restaurant-name">${foodEmoji} ${restaurant.name}</div>
                                </div>
                                <div class="header-right">
                                    <button class="favorite-btn active" onclick="removeFavorite('${restaurant.id}', event)">
                                        â™¥
                                    </button>
                                </div>
                            </div>
                            <div class="restaurant-info">
                                <div class="info-item">
                                    <span class="rating">â˜… ${restaurant.rating}</span>
                                    <span>(${restaurant.reviewCount})</span>
                                </div>
                                <div class="info-item">
                                    <span class="price-level">${priceSymbol}</span>
                                    ${priceRange ? `<span class="price-range">${priceRange}</span>` : ''}
                                </div>
                                <div class="info-item">
                                    <span class="distance">ğŸ“ ${restaurant.distance}m</span>
                                </div>
                            </div>
                            ${restaurant.businessHours ? `<div class="business-hours">ğŸ• ${restaurant.businessHours}</div>` : ''}
                            <a href="${restaurant.url}" target="_blank" class="map-link">
                                åœ¨ Google Maps æŸ¥çœ‹ â†’
                            </a>
                        </div>
                    `;
                }).join('');
                
                favoritesList.innerHTML = cardsHtml;
            }
            
            modal.classList.add('active');
        }

        // å¾æ”¶è—æ¸…å–®ç§»é™¤
        function removeFavorite(restaurantId, event) {
            event.preventDefault();
            event.stopPropagation();
            
            const favorites = getFavorites();
            const filtered = favorites.filter(fav => fav.id !== restaurantId);
            saveFavorites(filtered);
            
            // é‡æ–°é¡¯ç¤ºæ”¶è—æ¸…å–®
            showFavorites();
        }

        // é—œé–‰æ”¶è—æ¸…å–®
        function closeFavorites() {
            document.getElementById('favoritesModal').classList.remove('active');
        }

        // äº‹ä»¶ç›£è½
        document.getElementById('favoritesBtn').addEventListener('click', showFavorites);
        document.getElementById('closeModal').addEventListener('click', closeFavorites);
        document.getElementById('favoritesModal').addEventListener('click', (e) => {
            if (e.target.id === 'favoritesModal') {
                closeFavorites();
            }
        });

        // åˆå§‹åŒ–æ”¶è—æ•¸é‡
        updateFavoritesCount();

        // ========== åˆ†äº«åŠŸèƒ½ ==========
        
        // åˆ†äº«æœå°‹
        function shareSearch() {
            const line = document.getElementById('line').value;
            const station = document.getElementById('station').value;
            const foodType = document.getElementById('foodType').value;
            
            if (!line || !station || !foodType) {
                showToast('è«‹å…ˆå®Œæˆæœå°‹æ‰èƒ½åˆ†äº«å–”ï¼');
                return;
            }
            
            // å»ºç«‹åˆ†äº«é€£çµ
            const url = new URL(window.location.href);
            url.searchParams.set('line', line);
            url.searchParams.set('station', station);
            url.searchParams.set('food', foodType);
            
            // è¤‡è£½åˆ°å‰ªè²¼ç°¿
            navigator.clipboard.writeText(url.toString()).then(() => {
                showToast('âœ“ å·²è¤‡è£½åˆ†äº«é€£çµï¼');
            }).catch(() => {
                showToast('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ç¶²å€');
            });
        }

        // é¡¯ç¤º Toast æç¤º
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // å¾ URL åƒæ•¸è‡ªå‹•è¼‰å…¥æœå°‹
        function loadFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const line = urlParams.get('line');
            const station = urlParams.get('station');
            const food = urlParams.get('food');
            
            if (line && station && food) {
                // å¡«å…¥é¸é …
                document.getElementById('line').value = line;
                
                // è§¸ç™¼è·¯ç·šæ”¹è®Šäº‹ä»¶ä»¥è¼‰å…¥ç«™é»
                const event = new Event('change');
                document.getElementById('line').dispatchEvent(event);
                
                // ç­‰å¾…ç«™é»è¼‰å…¥å¾Œé¸æ“‡ç«™é»
                setTimeout(() => {
                    document.getElementById('station').value = station;
                    document.getElementById('foodType').value = food;
                    
                    // è‡ªå‹•åŸ·è¡Œæœå°‹
                    setTimeout(() => {
                        document.getElementById('searchBtn').click();
                    }, 500);
                }, 100);
            }
        }

        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥ URL åƒæ•¸
        loadFromURL();
    </script>
</body>
</html>